<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Available Trucks</title>
        <!-- Include your CSS and JavaScript libraries -->

        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBJx3BhuXQPo97BXMmGj_hwnOLOlV-O2EQ&libraries=places"></script>

        <!-- Favicon -->
        <link href="img/favicon.ico" rel="icon" />

        <!-- Google Web Fonts -->
        <link rel="preconnect" href="https://fonts.gstatic.com" />
        <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Rubik&display=swap" rel="stylesheet" />

        <!-- Font Awesome -->
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/all.min.css" rel="stylesheet" />

        <!-- Libraries Stylesheet -->
        <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
        <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

        <!-- Customized Bootstrap Stylesheet -->
        <link href="css/bootstrap.min.css" rel="stylesheet" />

        <!-- Template Stylesheet -->
        <link href="css/style.css" rel="stylesheet" />
    </head>
    <body>
        <form id="truckFilterForm">
            <div class="row">
                <div class="col-xl-2">
                    <label>Pickup Location:</label>
                    <input id="pickup-location" type="text" />
                </div>

                <div class="col-xl-2">
                    <label>Drop Location:</label>
                    <input id="drop-location" type="text" />
                </div>

                <div class="col-xl-2">
                    <label>Pickup Date:</label>
                    <input id="pickup-date" type="text" />
                </div>

                <div class="col-xl-2">
                    <label>Vehicle Type:</label>
                    <select id="selected-vehicle">
                        <option value="Frozen">Frozen</option>
                        <option value="Chiller">Chiller</option>
                        <option value="Dry">Dry</option>
                    </select>
                </div>

                <!-- <div class="col-xl-3"> -->
                <button type="button" onclick="fetchAvailableTrucks()">Search</button>
                <!-- </div> -->
            </div>
        </form>

        <div id="truckList">
            <!-- Available trucks will be displayed here -->
        </div>

        <script src="js/main.js"></script>

        <script>
            // Get all the vehicle boxes
            const vehicleBoxes = document.querySelectorAll(".vehicle-box");
            const hiddenInput = document.getElementById("selected-vehicle");

            vehicleBoxes.forEach((box) => {
                box.addEventListener("click", function () {
                    // Remove the 'selected' class from all boxes
                    vehicleBoxes.forEach((box) => box.classList.remove("selected"));

                    // Add the 'selected' class to the clicked box
                    this.classList.add("selected");

                    // Set the value of the hidden input to the selected vehicle's data-value
                    const selectedVehicle = this.getAttribute("data-value");
                    hiddenInput.value = selectedVehicle;

                    console.log("Selected vehicle:", selectedVehicle);
                });
            });
        </script>
        <script>
            function initAutocomplete() {
                var pickupInput = document.getElementById("pickup-location");
                var dropInput = document.getElementById("drop-location");
                var storageInput = document.getElementById("storage-location");

                var pickupAutocomplete = new google.maps.places.Autocomplete(pickupInput);
                var dropAutocomplete = new google.maps.places.Autocomplete(dropInput);
                var storageAutocomplete = new google.maps.places.Autocomplete(storageInput);

                pickupAutocomplete.setComponentRestrictions({ country: ["IN", "PK", "BD", "NP", "BT", "LK", "MV"] });
                dropAutocomplete.setComponentRestrictions({ country: ["IN", "PK", "BD", "NP", "BT", "LK", "MV"] });
                storageAutocomplete.setComponentRestrictions({ country: ["IN", "PK", "BD", "NP", "BT", "LK", "MV"] });

                // Add listeners to handle the selected place
                pickupAutocomplete.addListener("place_changed", function () {
                    var place = pickupAutocomplete.getPlace();
                    console.log("Pickup location:", place);
                });

                dropAutocomplete.addListener("place_changed", function () {
                    var place = dropAutocomplete.getPlace();
                    console.log("Drop location:", place);
                });

                storageAutocomplete.addListener("place_changed", function () {
                    var place = storageAutocomplete.getPlace();
                    console.log("Storage location:", place);
                });
            }

            // Initialize Google Maps Autocomplete after the page loads
            google.maps.event.addDomListener(window, "load", initAutocomplete);
        </script>

        <script>
            // Populate fields with data from localStorage
            document.getElementById("pickup-location").value = localStorage.getItem("pickupLocation");
            document.getElementById("drop-location").value = localStorage.getItem("dropLocation");
            document.getElementById("pickup-date").value = localStorage.getItem("pickupDate");
            document.getElementById("selected-vehicle").value = localStorage.getItem("selectedVehicle");

            function fetchAvailableTrucks() {
                const pickupLocation = document.getElementById("pickup-location").value;
                const dropLocation = document.getElementById("drop-location").value;
                const pickupDate = document.getElementById("pickup-date").value;
                const selectedVehicle = document.getElementById("selected-vehicle").value;

                // Fetch available trucks from MongoDB
                //   fetch('/api/getAvailableTrucks', {
                //     method: 'POST',
                //     headers: {
                //       'Content-Type': 'application/json'
                //     },
                //     body: JSON.stringify({ pickupLocation, dropLocation, pickupDate, selectedVehicle })
                //   })
                //   .then(response => response.json())
                //   .then(data => {
                //     // Display trucks
                //     const truckList = document.getElementById('truckList');
                //     truckList.innerHTML = '';

                //     data.trucks.forEach(truck => {
                //       const truckItem = document.createElement('div');
                //       truckItem.textContent = `Truck ID: ${truck.id}, Size: ${truck.size}, Temp Range: ${truck.tempRange}`;
                //       truckList.appendChild(truckItem);
                //     });
                //   });
            }

            // Fetch trucks on page load based on initial data
            fetchAvailableTrucks();
        </script>
    </body>
</html>
